---
title: "Final_Project"
author: "Yen Wang and Nathan Frank"
date: "5/2/2022"
output:
  html_document: default
  pdf_document: default
---

Final Project
Yen Wang and Nathan Frank

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(rvest)
library(tidyverse)
library(lubridate)
library(maps)
```

1.US minimum Wage by State from 1968 to 2017 https://www.kaggle.com/datasets/lislejoem/us-minimum-wage-by-state-from-1968-to-2017
This data set lists the minimum wage in every state in the U.S. from 1968 until 2017.

2.U.S. Inflation Rate 1960-2022
https://www.macrotrends.net/countries/USA/united-states/inflation-rate-cpi
This website shows the inflation rate in the United States in a similar time period as our first data set.

Cleaning: The firs tdata set includes U.S. territories such as Puerto Rico and the U.S. Virgin Islands which will not be included since we are only looking at states on our maps.

```{r}
mwd <- read.csv("Minimum Wage Data.csv")
mwd = mwd %>% filter(State != "Puerto Rico")
mwd = mwd %>% filter(State != "U.S. Virgin Islands")
head(mwd)

url = "https://www.macrotrends.net/countries/USA/united-states/inflation-rate-cpi"
html <- read_html(url)
tables = html %>% html_table(fill = TRUE)
rl = tables[[2]]
names(rl)[1] = "Year"
names(rl)[2] = "Inflation Rate (%)"
names(rl)[3] = "Annual Change"
rl1 <- rl[-c(1), ]
head(rl1)
```

```{r}
str(mwd)
str(rl1)
rl2 = rl1 %>% mutate(`Inflation Rate (%)` = parse_number(`Inflation Rate (%)`), 
               `Annual Change` = parse_number(`Annual Change`), 
               Year = as.factor(Year))
mwd = mwd %>% mutate(Year = as.factor(Year))

```


## The average minimum wage of every state through out the years
```{r}
mwd.state = mwd %>% group_by(State) %>% 
  summarise(m.state = mean(State.Minimum.Wage.2020.Dollars, na.rm = TRUE)) %>%
  arrange(desc(m.state))

mwd.state %>% ggplot(aes(x = State)) + 
  geom_bar(aes(weight = m.state)) + 
  coord_flip() + 
  ylab("State Minimum Wage")

```

## The average minimum wage through out the years

```{r}
mwd.year = mwd %>% group_by(Year) %>% 
  summarise(m.year = mean(State.Minimum.Wage, na.rm = TRUE), 
            m.year.2020 = mean(State.Minimum.Wage.2020.Dollars, na.rm = TRUE))

mwd.year %>% ggplot(aes(x = Year)) + 
  geom_bar(aes(weight = m.year)) + 
  coord_flip() + 
  ylab("State Minimum Wage")

mwd.year %>% ggplot(aes(x = Year)) + 
  geom_bar(aes(weight = m.year.2020)) + 
  coord_flip() + 
  ylab("State Minimum Wage in 2020 Dollars")



```

```{r}
mwd.enforced = mwd %>% group_by(State) %>% 
  summarise(m.high = mean(Department.Of.Labor.Cleaned.High.Value.2020.Dollars, na.rm = TRUE), 
            m.low = mean(Department.Of.Labor.Cleaned.Low.Value.2020.Dollars, na.rm = TRUE))

head(mwd.enforced)
```


#Effective Wage
The effective minimum wage variable is the minimum wage that it enforced in each state. This number is equal to the maximum between a state's minimum wage and the federal minimum wage. The following box-plots show that the median wage is close to the feral wage until in each year except 2020. All outliers on the plots are caused by a higher effective minimum wage than the upper whisker. The median wage is close to the federal minimum wage because any state that has a wage lower must use the federal minimum wage. This pattern does not continue into 2020 because the median value is over a dollar more than the federal minimum wage.
```{r}

mwd %>% filter(Year %in% c(1970, 1980, 1990, 2000, 2010, 2020)) %>% ggplot(aes(x=Effective.Minimum.Wage)) + geom_boxplot() + facet_grid(~Year, scales = "free") +
  labs(title="State Average Effective Minimum Wage", x="Effective Minimum Wage (dollars)")

```


#Maps
Here are maps that look at the effective minimum wage in 1968 and 2020. The map of 1968 has many more states with effective minimum wages equal to the federal minimum wage compared to 2020. In 1968, the states with the highest minimum wage were on the east and west coast. This is also true in 2020, and it is most likely because they are states with large cities that have higher costs of living.

```{r}
states <- map_data("state")

mwd2 = mwd
mwd2$region = tolower(mwd2$State)

mwd2 = mwd2 %>% filter(State != "hawaii", State != "alaska")

mwd.map2020 = mwd2 %>% filter(Year == 2020) %>% left_join(states, by="region")

mwd.map1968 = mwd2 %>% filter(Year == 1968) %>% left_join(states, by="region")

mwd.map1968 %>%
  ggplot(aes(x = long, y = lat, fill=Effective.Minimum.Wage)) +
  geom_polygon(aes(group=group)) + scale_fill_gradientn(colors=rainbow(5)) +
  labs(title="Effective Minimum Wage 1968")

mwd.map2020 %>%
  ggplot(aes(x = long, y = lat, fill=Effective.Minimum.Wage)) +
  geom_polygon(aes(group=group)) + scale_fill_gradientn(colors=rainbow(5)) +
  labs(title="Effective Minimum Wage 2020")


```


#Minimum Wage compared to inflation
The following line graphs compare the average effective minimum wage and the federal minimum wage each year to the minimum wage if it grew equal to inflation each year after 1968. The average state minimum wage does a better job growing with inflation, but it is consistently less than the expected wage. The federal minimum wage does not grow as well with inflation making jumps up less often. It is also consistently below the expected wage. These trends show that minimum wage does not keep up with inflation, and it can making very hard on people working minimum wage jobs to support their lifestyles.

```{r}

mwd.year = mwd %>% group_by(Year) %>% 
  summarise(m.wage = mean(Effective.Minimum.Wage, na.rm = TRUE), fed.wage = mean(Federal.Minimum.Wage, na.rm= TRUE))

rl3 = rl2 %>% filter(as.integer(as.character(Year)) > 1967)
rl3$Year = as.integer(as.character(rl3$Year))
mwd.year$Year = as.integer(as.character(mwd.year$Year))
wage.with.inflation = mwd.year %>% left_join(rl3, by="Year")

wage.with.inflation$ExpectedWage = wage.with.inflation$m.wage[1]

for (x in 2:53) {
  wage.with.inflation$ExpectedWage[x] = wage.with.inflation$ExpectedWage[x-1] * (1 + wage.with.inflation$`Inflation Rate (%)`[x-1] / 100)
}


ggplot(wage.with.inflation, aes(x=Year, group=1)) + 
  geom_line(aes(y = m.wage, colour = "Average State Minimum Effective Wage")) + 
  geom_line(aes(y = ExpectedWage, color = "Expected Wage")) +
  labs(title="Average State Minimum Effective Wage vs Expected Wage", y="Minimum Effective Wage", color="Key")



ggplot(wage.with.inflation, aes(x=Year, group=1)) + 
  geom_line(aes(y = fed.wage, colour = "Federal Minimum Wage")) + 
  geom_line(aes(y = ExpectedWage, color = "Expected Wage")) +
  labs(title="Federal Minimum Wage vs Expected Wage", y="Minimum Effective Wage", color="Key")
``` 

